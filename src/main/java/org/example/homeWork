--Введение в SQL
\l
\c skypro
CREATE TABLE employee (
                          id BIGSERIAL NOT NULL PRIMARY KEY,
                          first_name VARCHAR(50) NOT NULL,
                          last_name VARCHAR(50) NOT NULL,
                          gender VARCHAR(6) NOT NULL,
                              age INT NOT NULL
);
SELECT * FROM employee;
INSERT INTO employee (
    first_name, last_name, gender, age)
VALUES ('Ivan', 'Ivanov', 'male', 30);
SELECT * FROM employee;
INSERT INTO employee (
    first_name, last_name, gender, age)
VALUES ('Elena', 'Morozova', 'female', 23);
INSERT INTO employee (
    first_name, last_name, gender, age)
VALUES ('Vasja', 'Arutinjan', 'male', 38);
SELECT * FROM employee;
UPDATE employee SET first_name = 'Oleg', last_name = 'Bodrov', gender = 'male', age = 50 WHERE id = 2;
SELECT * FROM employee;
DELETE FROM employee WHERE id = 3;
SELECT * FROM employee;
\q
--Выборка данных и вложенные хапросы
--Задание 1
INSERT INTO employee (
    first_name, last_name, gender, age)
VALUES ('Nikolau', 'Gusev', 'male', 18);
INSERT INTO employee (
    first_name, last_name, gender, age)
VALUES ('Alisa', 'Juk', 'female', 55);
INSERT INTO employee (
    first_name, last_name, gender, age)
VALUES ('Elena', 'Ivanova', 'female', 26);
SELECT first_name AS Имя,last_name AS Фамилия,
       SUM(age) AS Возраст FROM employee GROUP BY Имя, Фамилия;
SELECT first_name FROM employee WHERE age > 50 OR age < 30 ORDER BY first_name;
SELECT * FROM employee WHERE age BETWEEN 30 and 50;
SELECT last_name AS Фамилия FROM employee ORDER BY Фамилия DESC;
SELECT * FROM employee WHERE LENGTH(first_name) > 4;
--Задание 2
UPDATE employee
SET first_name = 'Alisa'
WHERE id =  7;
UPDATE employee
SET first_name = 'Vasja'
WHERE id =  4;
SELECT first_name AS Имя, SUM(age) AS "Суммарный возраст"
FROM employee
GROUP BY first_name;
SELECT first_name AS Имя, MIN(age) AS "Самый маленький возраст"
FROM employee
GROUP BY first_name;
SELECT first_name AS Имя, MAX(age) AS "Максимальный возраст"
FROM employee
WHERE first_name IN (
    SELECT first_name
    FROM employee
    GROUP BY first_name
    HAVING COUNT(*) > 1
    )
GROUP BY first_name
ORDER BY "Максимальный возраст";
--Задание 3
CREATE TABLE city (
    city_id BIGSERIAL NOT NULL PRIMARY KEY,
    city_name VARCHAR(50) NOT NULL
);
ALTER TABLE employee
    ADD COLUMN city_id BIGINT REFERENCES city (city_id);
INSERT INTO city(city_name)
VALUES ('г.Москва'),
       ('с.Сахарная головка'),
       ('г.Симферополь'),
       ('с.Мытищи');
UPDATE employee
SET city_id = 1
WHERE id = 1;
UPDATE employee
SET city_id = 1
WHERE id = 7;
UPDATE employee
SET city_id = 2
WHERE id = 4;
UPDATE employee
SET city_id = 3
WHERE id = 6;
SELECT e.first_name, e.last_name, c.city_name
FROM employee e
INNER JOIN city c ON e.city_id = c.city_id;
SELECT e.first_name, e.last_name, c.city_name
FROM employee e
LEFT JOIN city c ON e.city_id = c.city_id;
SELECT e.first_name, e.last_name, c.city_name
FROM employee e
RIGHT JOIN city c ON e.city_id = c.city_id;
SELECT e.first_name, e.last_name, c.city_name
FROM employee e
FULL JOIN city c ON e.city_id = c.city_id;
SELECT e.first_name, e.last_name, c.city_name
FROM employee e
CROSS JOIN city c;

